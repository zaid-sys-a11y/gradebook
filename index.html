<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Zaid's Gradebook</title>
<link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500;600&family=Outfit:wght@400;500;600;700;800&display=swap" rel="stylesheet">
<style>
  :root {
    --bg: #0a0c10; --surface: #13161d; --surface2: #1b1f2a; --border: #252a38;
    --text: #e8eaf0; --text-muted: #6b7089; --accent: #6c8cff;
    --accent2: #a855f7; --accent-glow: rgba(108, 140, 255, 0.12);
    --green: #4ade80; --red: #f87171; --orange: #fb923c;
    --minor-tag: #3b82f6; --major-tag: #a855f7; --radius: 12px;
  }
  * { margin: 0; padding: 0; box-sizing: border-box; }
  body { font-family: 'DM Sans', sans-serif; background: var(--bg); color: var(--text); min-height: 100vh; padding: 30px 20px; }

  /* Auth */
  .auth-screen { position: fixed; inset: 0; background: var(--bg); display: flex; align-items: center; justify-content: center; z-index: 100; }
  .auth-screen.hidden { display: none; }
  .auth-box { background: var(--surface); border: 1px solid var(--border); border-radius: 16px; padding: 40px; text-align: center; width: 400px; box-shadow: 0 20px 60px rgba(0,0,0,0.5); }
  .auth-box h2 { font-family: 'Outfit', sans-serif; font-size: 26px; font-weight: 800; margin-bottom: 4px; background: linear-gradient(135deg, #6c8cff 0%, #a855f7 50%, #ec4899 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; letter-spacing: -0.5px; }
  .auth-box p { font-size: 13px; color: var(--text-muted); margin-bottom: 24px; }
  .auth-box input { width: 100%; background: var(--surface2); border: 1px solid var(--border); border-radius: 8px; padding: 11px 16px; color: var(--text); font-family: 'DM Sans', sans-serif; font-size: 14px; outline: none; margin-bottom: 10px; transition: all 0.2s; }
  .auth-box input:focus { border-color: var(--accent); box-shadow: 0 0 0 3px var(--accent-glow); }
  .auth-btn { width: 100%; background: linear-gradient(135deg, #6c8cff, #a855f7, #ec4899); border: none; color: white; padding: 12px; border-radius: 8px; font-family: 'DM Sans', sans-serif; font-size: 14px; font-weight: 600; cursor: pointer; transition: all 0.2s; margin-bottom: 12px; }
  .auth-btn:hover { opacity: 0.9; transform: translateY(-1px); box-shadow: 0 4px 20px rgba(108,140,255,0.3); }
  .auth-btn:disabled { opacity: 0.5; cursor: not-allowed; transform: none; }
  .auth-toggle { font-size: 13px; color: var(--text-muted); cursor: pointer; }
  .auth-toggle span { color: var(--accent); font-weight: 600; }
  .auth-toggle span:hover { text-decoration: underline; }
  .auth-error { color: var(--red); font-size: 12px; margin-top: 8px; min-height: 18px; }

  /* Blocked */
  .blocked-screen { position: fixed; inset: 0; background: var(--bg); display: flex; align-items: center; justify-content: center; z-index: 100; }
  .blocked-screen.hidden { display: none; }
  .blocked-box { background: var(--surface); border: 1px solid var(--border); border-radius: 16px; padding: 40px; text-align: center; width: 400px; }
  .blocked-box h2 { font-size: 20px; color: var(--red); margin-bottom: 10px; }
  .blocked-box p { font-size: 14px; color: var(--text-muted); margin-bottom: 20px; }

  /* Top Bar */
  .top-bar { position: fixed; top: 0; left: 0; right: 0; background: rgba(10,12,16,0.85); backdrop-filter: blur(12px); -webkit-backdrop-filter: blur(12px); border-bottom: 1px solid var(--border); padding: 10px 24px; display: none; justify-content: flex-end; align-items: center; gap: 12px; z-index: 50; }
  .top-bar.visible { display: flex; }
  .user-badge { display: flex; align-items: center; gap: 8px; }
  .user-avatar { width: 30px; height: 30px; border-radius: 50%; background: linear-gradient(135deg, #6c8cff, #a855f7); display: flex; align-items: center; justify-content: center; font-size: 11px; font-weight: 700; color: white; }
  .user-name { font-size: 13px; font-weight: 500; color: var(--text); }
  .admin-tag { font-size: 9px; background: rgba(168,85,247,0.2); color: var(--major-tag); padding: 3px 8px; border-radius: 10px; font-weight: 700; text-transform: uppercase; letter-spacing: 0.8px; }
  .top-btn { background: var(--surface2); border: 1px solid var(--border); color: var(--text-muted); padding: 7px 14px; border-radius: 8px; font-family: 'DM Sans', sans-serif; font-size: 12px; font-weight: 500; cursor: pointer; transition: all 0.2s; }
  .top-btn:hover { border-color: var(--accent); color: var(--accent); }
  .top-btn.danger:hover { border-color: var(--red); color: var(--red); }

  /* Container */
  .container { max-width: 860px; margin: 0 auto; padding-top: 50px; }
  .container.hidden { display: none; }

  /* Header */
  header { text-align: center; margin-bottom: 28px; position: relative; }
  .header-badge { display: inline-flex; align-items: center; gap: 6px; background: var(--surface); border: 1px solid var(--border); border-radius: 20px; padding: 4px 14px 4px 8px; margin-bottom: 12px; font-size: 11px; color: var(--text-muted); font-weight: 500; }
  .header-badge-dot { width: 6px; height: 6px; border-radius: 50%; background: var(--green); animation: pulse 2s ease infinite; }
  @keyframes pulse { 0%,100%{opacity:1;} 50%{opacity:0.4;} }
  header h1 { font-family: 'Outfit', sans-serif; font-size: 32px; font-weight: 800; letter-spacing: -1px; background: linear-gradient(135deg, #6c8cff 0%, #a855f7 40%, #ec4899 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; line-height: 1.1; }
  header .subtitle { font-size: 13px; color: var(--text-muted); margin-top: 6px; font-weight: 400; }

  /* Tabs */
  .tab-bar { display: flex; gap: 4px; margin-bottom: 24px; background: var(--surface); border: 1px solid var(--border); border-radius: var(--radius); padding: 4px; }
  .tab-btn { flex: 1; padding: 10px 16px; font-family: 'DM Sans', sans-serif; font-size: 13px; font-weight: 600; border: none; cursor: pointer; background: transparent; color: var(--text-muted); transition: all 0.2s; border-radius: 8px; }
  .tab-btn.active { background: var(--surface2); color: var(--text); box-shadow: 0 2px 8px rgba(0,0,0,0.2); }
  .tab-btn:not(.active):hover { color: var(--text); }
  .tab-content { display: none; }
  .tab-content.active { display: block; }

  /* Settings */
  .settings { display: flex; gap: 12px; margin-bottom: 20px; flex-wrap: wrap; }
  .setting-card { background: var(--surface); border: 1px solid var(--border); border-radius: var(--radius); padding: 14px 16px; flex: 1; min-width: 170px; }
  .setting-card label { display: block; font-size: 10px; text-transform: uppercase; letter-spacing: 1px; color: var(--text-muted); margin-bottom: 8px; font-weight: 600; }
  .setting-card input { width: 100%; background: var(--surface2); border: 1px solid var(--border); border-radius: 8px; padding: 8px 12px; color: var(--text); font-family: 'JetBrains Mono', monospace; font-size: 15px; font-weight: 500; outline: none; transition: all 0.2s; }
  .setting-card input:focus { border-color: var(--accent); box-shadow: 0 0 0 3px var(--accent-glow); }

  /* Paste */
  .paste-section { background: var(--surface); border: 1px solid var(--border); border-radius: var(--radius); padding: 20px; margin-bottom: 20px; }
  .paste-header { display: flex; align-items: center; margin-bottom: 10px; }
  .paste-title { font-size: 13px; font-weight: 600; color: var(--text); }
  .paste-area { width: 100%; min-height: 90px; background: var(--surface2); border: 2px dashed var(--border); border-radius: 10px; padding: 14px; color: var(--text); font-family: 'JetBrains Mono', monospace; font-size: 12px; outline: none; resize: vertical; transition: all 0.2s; line-height: 1.6; }
  .paste-area:focus { border-color: var(--accent); border-style: solid; box-shadow: 0 0 0 3px var(--accent-glow); }
  .paste-area::placeholder { color: var(--text-muted); }
  .paste-actions { display: flex; gap: 10px; margin-top: 12px; align-items: center; }
  .parse-btn { background: linear-gradient(135deg, #6c8cff, #a855f7); border: none; color: white; padding: 9px 20px; border-radius: 8px; font-family: 'DM Sans', sans-serif; font-size: 13px; font-weight: 600; cursor: pointer; transition: all 0.2s; }
  .parse-btn:hover { opacity: 0.9; transform: translateY(-1px); }
  .paste-status { font-size: 12px; color: var(--text-muted); }
  .paste-status.success { color: var(--green); }
  .paste-status.error { color: var(--red); }

  /* Table */
  .table-wrapper { background: var(--surface); border: 1px solid var(--border); border-radius: var(--radius); overflow: hidden; margin-bottom: 20px; }
  table { width: 100%; border-collapse: collapse; }
  thead th { background: var(--surface2); padding: 11px 16px; font-size: 10px; text-transform: uppercase; letter-spacing: 1px; color: var(--text-muted); font-weight: 600; text-align: left; border-bottom: 1px solid var(--border); }
  thead th:last-child { text-align: center; }
  tbody tr { border-bottom: 1px solid rgba(37,42,56,0.6); transition: background 0.15s; }
  tbody tr:last-child { border-bottom: none; }
  tbody tr:hover { background: rgba(108, 140, 255, 0.03); }
  tbody td { padding: 10px 16px; font-size: 14px; vertical-align: middle; }
  tbody td input { background: var(--surface2); border: 1px solid var(--border); border-radius: 8px; padding: 7px 10px; color: var(--text); font-family: 'JetBrains Mono', monospace; font-size: 13px; outline: none; transition: all 0.2s; width: 100%; }
  tbody td input:focus { border-color: var(--accent); box-shadow: 0 0 0 3px var(--accent-glow); }
  td input.name-input { min-width: 160px; font-family: 'DM Sans', sans-serif; }
  td input.num-input { width: 70px; text-align: center; }
  td input.grade-input { width: 80px; text-align: center; }
  td input.grade-input.nm { color: var(--text-muted); font-style: italic; }
  td input.grade-input.ng { color: var(--red); font-weight: 600; }
  .type-toggle { display: flex; gap: 0; border-radius: 8px; overflow: hidden; border: 1px solid var(--border); }
  .type-toggle button { flex: 1; padding: 7px 12px; font-size: 11px; font-weight: 600; font-family: 'DM Sans', sans-serif; border: none; cursor: pointer; transition: all 0.2s; background: var(--surface2); color: var(--text-muted); white-space: nowrap; }
  .type-toggle button.active-minor { background: rgba(59, 130, 246, 0.15); color: var(--minor-tag); }
  .type-toggle button.active-major { background: rgba(168, 85, 247, 0.15); color: var(--major-tag); }
  .delete-btn { background: none; border: none; color: var(--text-muted); cursor: pointer; font-size: 16px; padding: 4px 8px; border-radius: 6px; transition: all 0.15s; display: flex; align-items: center; justify-content: center; margin: 0 auto; opacity: 0.5; }
  .delete-btn:hover { color: var(--red); background: rgba(248, 113, 113, 0.1); opacity: 1; }
  .add-row { display: flex; justify-content: center; padding: 12px; }
  .add-btn { background: var(--surface2); border: 1px dashed var(--border); color: var(--text-muted); padding: 8px 24px; border-radius: 8px; font-family: 'DM Sans', sans-serif; font-size: 13px; font-weight: 500; cursor: pointer; transition: all 0.2s; }
  .add-btn:hover { border-color: var(--accent); color: var(--accent); background: var(--accent-glow); }

  /* Results */
  .results { display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 12px; margin-top: 20px; margin-bottom: 20px; }
  .result-card { background: var(--surface); border: 1px solid var(--border); border-radius: var(--radius); padding: 18px; text-align: center; }
  .result-card.final { border-color: rgba(108,140,255,0.3); background: linear-gradient(135deg, rgba(108,140,255,0.06), rgba(168,85,247,0.06)); grid-column: 1 / -1; }
  .result-label { font-size: 10px; text-transform: uppercase; letter-spacing: 1.2px; color: var(--text-muted); font-weight: 600; margin-bottom: 8px; }
  .result-value { font-family: 'JetBrains Mono', monospace; font-size: 28px; font-weight: 600; }
  .result-card.final .result-value { font-size: 36px; background: linear-gradient(135deg, #6c8cff, #a855f7); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
  .result-detail { font-size: 11px; color: var(--text-muted); margin-top: 4px; font-family: 'JetBrains Mono', monospace; }
  .color-green { color: var(--green); }
  .color-orange { color: var(--orange); }
  .color-red { color: var(--red); }

  /* Admin */
  .admin-panel { background: var(--surface); border: 1px solid var(--border); border-radius: var(--radius); padding: 24px; margin-bottom: 20px; }
  .admin-panel.hidden { display: none; }
  .admin-title { font-size: 15px; font-weight: 700; color: var(--text); margin-bottom: 14px; display: flex; align-items: center; gap: 8px; }
  .admin-title .admin-tag { font-size: 10px; }
  .user-list { display: flex; flex-direction: column; gap: 8px; }
  .user-row { display: flex; align-items: center; justify-content: space-between; background: var(--surface2); border: 1px solid var(--border); border-radius: 10px; padding: 10px 16px; }
  .user-row.blocked { opacity: 0.5; border-color: var(--red); }
  .user-info { display: flex; flex-direction: column; gap: 2px; }
  .user-info .name { font-size: 14px; font-weight: 500; }
  .user-info .email { font-size: 12px; color: var(--text-muted); }
  .user-info .joined { font-size: 11px; color: var(--text-muted); }
  .kick-btn { background: none; border: 1px solid var(--border); color: var(--text-muted); padding: 5px 14px; border-radius: 8px; font-family: 'DM Sans', sans-serif; font-size: 12px; font-weight: 500; cursor: pointer; transition: all 0.2s; }
  .kick-btn:hover { border-color: var(--red); color: var(--red); background: rgba(248,113,113,0.1); }
  .kick-btn.unblock { color: var(--green); border-color: var(--green); }
  .kick-btn.unblock:hover { background: rgba(74,222,128,0.1); }
  .no-users { color: var(--text-muted); font-size: 13px; text-align: center; padding: 16px; }

  /* Toggle */
  .toggle-section { background: var(--surface); border: 1px solid var(--border); border-radius: var(--radius); padding: 14px 18px; margin-bottom: 20px; display: flex; align-items: center; justify-content: space-between; }
  .toggle-label { font-size: 13px; color: var(--text-muted); }
  .toggle-switch { position: relative; width: 44px; height: 24px; flex-shrink: 0; }
  .toggle-switch input { opacity: 0; width: 0; height: 0; }
  .toggle-slider { position: absolute; cursor: pointer; inset: 0; background: var(--surface2); border: 1px solid var(--border); border-radius: 24px; transition: 0.3s; }
  .toggle-slider:before { content: ''; position: absolute; height: 18px; width: 18px; left: 2px; bottom: 2px; background: var(--text-muted); border-radius: 50%; transition: 0.3s; }
  .toggle-switch input:checked + .toggle-slider { background: var(--accent); border-color: var(--accent); }
  .toggle-switch input:checked + .toggle-slider:before { transform: translateX(20px); background: white; }

  /* Semester */
  .sem-row { background: var(--surface); border: 1px solid var(--border); border-radius: var(--radius); padding: 16px; margin-bottom: 12px; }
  .sem-row-header { font-size: 14px; font-weight: 600; color: var(--text); margin-bottom: 12px; display: flex; align-items: center; justify-content: space-between; }
  .sem-inputs { display: flex; gap: 12px; flex-wrap: wrap; }
  .sem-field { flex: 1; min-width: 100px; }
  .sem-field label { display: block; font-size: 10px; text-transform: uppercase; letter-spacing: 0.5px; color: var(--text-muted); margin-bottom: 4px; font-weight: 600; }
  .sem-field input { width: 100%; background: var(--surface2); border: 1px solid var(--border); border-radius: 8px; padding: 8px 10px; color: var(--text); font-family: 'JetBrains Mono', monospace; font-size: 14px; text-align: center; outline: none; transition: all 0.2s; }
  .sem-field input:focus { border-color: var(--accent); box-shadow: 0 0 0 3px var(--accent-glow); }
  .sem-computed { background: transparent !important; border-color: transparent !important; font-weight: 600; }
  .sem-letter { font-size: 12px; text-align: center; margin-top: 2px; font-weight: 700; letter-spacing: 0.5px; }

  /* GPA Table */
  .gpa-table { width: 100%; border-collapse: collapse; }
  .gpa-table th { background: var(--surface2); padding: 10px 12px; font-size: 10px; text-transform: uppercase; letter-spacing: 1px; color: var(--text-muted); font-weight: 600; text-align: left; border-bottom: 1px solid var(--border); }
  .gpa-table td { padding: 9px 12px; font-size: 13px; border-bottom: 1px solid rgba(37,42,56,0.5); }
  .gpa-table tr:last-child td { border-bottom: none; }
  .gpa-table tr:hover { background: rgba(108, 140, 255, 0.03); }
  .gpa-table .course-name { font-family: 'DM Sans', sans-serif; font-weight: 500; max-width: 220px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
  .gpa-table .num { font-family: 'JetBrains Mono', monospace; text-align: center; font-size: 12px; }
  .gpa-table .section-header td { background: var(--surface2); font-weight: 700; font-size: 11px; color: var(--accent); text-transform: uppercase; letter-spacing: 1px; padding: 8px 12px; }
  .gpa-tag { display: inline-block; padding: 2px 8px; border-radius: 6px; font-size: 10px; font-weight: 700; letter-spacing: 0.5px; }
  .gpa-tag-a { background: rgba(74,222,128,0.12); color: var(--green); }
  .gpa-tag-b { background: rgba(108,140,255,0.12); color: var(--accent); }
  .gpa-tag-c { background: rgba(251,146,60,0.12); color: var(--orange); }
  .gpa-tag-d { background: rgba(245,158,11,0.12); color: #f59e0b; }
  .gpa-tag-f { background: rgba(248,113,113,0.12); color: var(--red); }

  @media (max-width: 600px) {
    body { padding: 16px 10px; }
    .settings { flex-direction: column; gap: 10px; }
    .setting-card { min-width: unset; }
    .container { padding-top: 56px; }
    header h1 { font-size: 24px; }
    td input.name-input { min-width: 80px; font-size: 12px; }
    td input.num-input { width: 50px; font-size: 12px; }
    td input.grade-input { width: 55px; font-size: 12px; }
    thead th, tbody td { padding: 6px 6px; font-size: 11px; }
    .type-toggle button { padding: 5px 8px; font-size: 10px; }
    .top-bar { padding: 8px 10px; gap: 6px; }
    .user-name { font-size: 11px; max-width: 80px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
    .top-btn { padding: 5px 10px; font-size: 11px; }
    .result-value { font-size: 22px; }
    .result-card.final .result-value { font-size: 28px; }
    .results { grid-template-columns: 1fr 1fr; gap: 10px; }
    .paste-area { min-height: 80px; font-size: 11px; padding: 10px; }
    .paste-actions { flex-wrap: wrap; }
    .admin-panel { padding: 16px; }
    .user-row { flex-direction: column; align-items: flex-start; gap: 8px; }
    .auth-box { width: 90vw; padding: 28px; }
    .blocked-box { width: 90vw; padding: 28px; }
    .toggle-section { padding: 12px 14px; }
    .toggle-label { font-size: 12px; }
    .table-wrapper { overflow-x: auto; }
    .sem-inputs { flex-direction: column; gap: 8px; }
    .sem-field { min-width: unset; }
    .tab-btn { font-size: 11px; padding: 9px 6px; }
    .gpa-table th, .gpa-table td { padding: 6px 8px; font-size: 11px; }
    .gpa-table .course-name { max-width: 120px; }
  }
</style>
</head>
<body>
<div class="auth-screen" id="authScreen">
  <div class="auth-box">
    <h2>Zaid's Gradebook</h2>
    <p id="authSubtitle">Sign in to continue</p>
    <input type="text" id="authName" placeholder="Full Name" style="display:none;">
    <input type="email" id="authEmail" placeholder="Email">
    <input type="password" id="authPassword" placeholder="Password" onkeydown="if(event.key==='Enter')handleAuth()">
    <button class="auth-btn" id="authBtn" onclick="handleAuth()">Sign In</button>
    <div class="auth-toggle" id="authToggle">Don't have an account? <span onclick="toggleAuthMode()">Sign Up</span></div>
    <div class="auth-error" id="authError"></div>
  </div>
</div>
<div class="blocked-screen hidden" id="blockedScreen">
  <div class="blocked-box"><h2>Access Revoked</h2><p>Your access has been removed by the admin.</p><button class="auth-btn" onclick="signOutUser()">Sign Out</button></div>
</div>
<div class="top-bar" id="topBar">
  <div class="user-badge"><div class="user-avatar" id="userAvatar"></div><span class="user-name" id="userName"></span><span class="admin-tag" id="adminTag" style="display:none;">Admin</span></div>
  <button class="top-btn" id="adminToggleBtn" style="display:none;" onclick="toggleAdminPanel()">Manage Users</button>
  <button class="top-btn danger" onclick="signOutUser()">Sign Out</button>
</div>
<div class="container hidden" id="mainContainer">
  <header>
    <div class="header-badge"><div class="header-badge-dot"></div>Madison Central</div>
    <h1>Zaid's Gradebook</h1>
    <div class="subtitle">Grade calculator, semester exams & GPA tracker</div>
  </header>
  <div class="admin-panel hidden" id="adminPanel">
    <div class="admin-title">Manage Users <span class="admin-tag">Admin</span></div>
    <div class="user-list" id="userList"><div class="no-users">Loading users...</div></div>
  </div>
  <div class="tab-bar">
    <button class="tab-btn active" onclick="switchTab('gradebook')">Grades</button>
    <button class="tab-btn" onclick="switchTab('semester')">Semester</button>
    <button class="tab-btn" onclick="switchTab('gpa')">GPA / QPA</button>
  </div>

  <!-- Gradebook -->
  <div class="tab-content active" id="tab-gradebook">
    <div class="settings">
      <div class="setting-card"><label>Minor Weight (%)</label><input type="number" id="minorWeight" value="34" min="0" max="100" oninput="calculate()"></div>
      <div class="setting-card"><label>Major Weight (%)</label><input type="number" id="majorWeight" value="66" min="0" max="100" oninput="calculate()"></div>
      <div class="setting-card"><label>Final Boost (%)</label><input type="number" id="boost" value="10" min="0" max="100" oninput="calculate()"></div>
    </div>
    <div class="toggle-section">
      <span class="toggle-label">Grades not matching up? Drop lowest minor</span>
      <label class="toggle-switch"><input type="checkbox" id="dropLowest" checked onchange="calculate()"><span class="toggle-slider"></span></label>
    </div>
    <div class="paste-section">
      <div class="paste-header"><span class="paste-title">Paste Grades from Gradebook</span></div>
      <textarea class="paste-area" id="pasteArea" placeholder="Copy and paste your gradebook table here exactly as it appears..."></textarea>
      <div class="paste-actions"><button class="parse-btn" onclick="parsePastedText()">Import Grades</button><button class="add-btn" onclick="resetAll()" style="margin-left:4px;">Reset</button><span class="paste-status" id="pasteStatus"></span></div>
    </div>
    <div class="table-wrapper">
      <table><thead><tr><th>Assignment</th><th>Type</th><th>Weight</th><th>Grade</th><th></th></tr></thead><tbody id="assignmentBody"></tbody></table>
      <div class="add-row"><button class="add-btn" onclick="addRow()">+ Add Assignment</button></div>
    </div>
    <div class="results" id="results"></div>
  </div>

  <!-- Semester -->
  <div class="tab-content" id="tab-semester">
    <p style="color:var(--text-muted);font-size:13px;margin-bottom:16px;text-align:center;">Final = (Term Avg × 80%) + (Exam × 20%)</p>
    <div id="semesterBlocks"></div>
    <div class="add-row"><button class="add-btn" onclick="addSemBlock()">+ Add Block</button></div>
  </div>

  <!-- GPA / QPA -->
  <div class="tab-content" id="tab-gpa">
    <div class="paste-section">
      <div class="paste-header"><span class="paste-title">Paste History Courses (from Courses tab)</span></div>
      <textarea class="paste-area" id="gpaHistoryArea" placeholder="Paste your History Courses table here..."></textarea>
      <div class="paste-actions"><button class="parse-btn" onclick="parseHistoryCourses()">Import History</button><span class="paste-status" id="gpaHistoryStatus"></span></div>
    </div>
    <div class="paste-section">
      <div class="paste-header"><span class="paste-title">Paste Current Year Grades (from Term Grades)</span></div>
      <textarea class="paste-area" id="gpaCurrentArea" placeholder="Paste your current year Term Grades table here..."></textarea>
      <div class="paste-actions"><button class="parse-btn" onclick="parseCurrentCourses()">Import Current</button><span class="paste-status" id="gpaCurrentStatus"></span></div>
    </div>
    <div class="paste-actions" style="margin-bottom:20px;justify-content:center;"><button class="add-btn" onclick="resetGPA()">Reset All</button></div>
    <div class="results" id="gpaResults"></div>
    <div class="table-wrapper" id="gpaTableWrapper" style="display:none;">
      <table class="gpa-table"><thead><tr><th>Course</th><th>Grade</th><th>QPs</th><th>Credits</th><th>Letter</th></tr></thead><tbody id="gpaBody"></tbody></table>
    </div>
  </div>
</div>

<script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore-compat.js"></script>
<script>
firebase.initializeApp({apiKey:"AIzaSyCs6Y3xz-OQ75b1iqiaKlftTzKL58_TUQ0",authDomain:"zaids-gradebook.firebaseapp.com",projectId:"zaids-gradebook",storageBucket:"zaids-gradebook.firebasestorage.app",messagingSenderId:"225222960158",appId:"1:225222960158:web:271b3159c3210829833a0f"});
const auth=firebase.auth(),db=firebase.firestore(),ADMIN_EMAIL='abdrabozaid@gmail.com';
let isSignUp=false,currentUser=null,isAdmin=false;
function toggleAuthMode(){isSignUp=!isSignUp;document.getElementById('authName').style.display=isSignUp?'block':'none';document.getElementById('authBtn').textContent=isSignUp?'Sign Up':'Sign In';document.getElementById('authSubtitle').textContent=isSignUp?'Create an account':'Sign in to continue';document.getElementById('authToggle').innerHTML=isSignUp?'Already have an account? <span onclick="toggleAuthMode()">Sign In</span>':'Don\'t have an account? <span onclick="toggleAuthMode()">Sign Up</span>';document.getElementById('authError').textContent='';}
async function handleAuth(){const email=document.getElementById('authEmail').value.trim(),password=document.getElementById('authPassword').value,name=document.getElementById('authName').value.trim(),errorEl=document.getElementById('authError'),btn=document.getElementById('authBtn');errorEl.textContent='';if(!email||!password){errorEl.textContent='Please fill in all fields';return;}if(isSignUp&&!name){errorEl.textContent='Please enter your name';return;}btn.disabled=true;btn.textContent=isSignUp?'Creating account...':'Signing in...';try{if(isSignUp){const uc=await auth.createUserWithEmailAndPassword(email,password);await db.collection('users').doc(uc.user.uid).set({name,email,blocked:false,joinedAt:firebase.firestore.FieldValue.serverTimestamp()});}else{await auth.signInWithEmailAndPassword(email,password);}}catch(err){const msgs={'auth/user-not-found':'Invalid email or password','auth/wrong-password':'Invalid email or password','auth/invalid-credential':'Invalid email or password','auth/email-already-in-use':'Email already in use. Try signing in.','auth/weak-password':'Password must be at least 6 characters','auth/invalid-email':'Invalid email address'};errorEl.textContent=msgs[err.code]||'Something went wrong';}btn.disabled=false;btn.textContent=isSignUp?'Sign Up':'Sign In';}
function signOutUser(){auth.signOut();}
auth.onAuthStateChanged(async(user)=>{if(user){currentUser=user;isAdmin=user.email===ADMIN_EMAIL;const userDoc=await db.collection('users').doc(user.uid).get();if(userDoc.exists&&userDoc.data().blocked){document.getElementById('authScreen').classList.add('hidden');document.getElementById('blockedScreen').classList.remove('hidden');document.getElementById('mainContainer').classList.add('hidden');document.getElementById('topBar').classList.remove('visible');return;}let dn='';if(userDoc.exists&&userDoc.data().name)dn=userDoc.data().name;else{const l=user.email.split('@')[0];dn=l.replace(/[._-]/g,' ').replace(/\d+/g,'').trim().split(/\s+/).filter(p=>p).map(p=>p[0].toUpperCase()+p.slice(1)).join(' ')||l;}const ini=dn.split(/\s+/).map(p=>p[0]).join('').toUpperCase().slice(0,2);document.getElementById('authScreen').classList.add('hidden');document.getElementById('blockedScreen').classList.add('hidden');document.getElementById('mainContainer').classList.remove('hidden');document.getElementById('topBar').classList.add('visible');document.getElementById('userName').textContent=dn;document.getElementById('userAvatar').textContent=ini;if(isAdmin){document.getElementById('adminTag').style.display='';document.getElementById('adminToggleBtn').style.display='';loadUsers();}else{document.getElementById('adminTag').style.display='none';document.getElementById('adminToggleBtn').style.display='none';document.getElementById('adminPanel').classList.add('hidden');}}else{currentUser=null;isAdmin=false;document.getElementById('authScreen').classList.remove('hidden');document.getElementById('blockedScreen').classList.add('hidden');document.getElementById('mainContainer').classList.add('hidden');document.getElementById('topBar').classList.remove('visible');document.getElementById('adminPanel').classList.add('hidden');}});
function toggleAdminPanel(){const p=document.getElementById('adminPanel');p.classList.toggle('hidden');if(!p.classList.contains('hidden'))loadUsers();}
async function loadUsers(){const el=document.getElementById('userList');el.innerHTML='<div class="no-users">Loading...</div>';try{const snap=await db.collection('users').orderBy('joinedAt','desc').get();if(snap.empty){el.innerHTML='<div class="no-users">No users yet</div>';return;}el.innerHTML='';snap.forEach(doc=>{const d=doc.data(),self=currentUser&&doc.id===currentUser.uid,j=d.joinedAt?new Date(d.joinedAt.seconds*1000).toLocaleDateString():'Unknown',r=document.createElement('div');r.className='user-row'+(d.blocked?' blocked':'');r.innerHTML=`<div class="user-info"><span class="name">${esc(d.name||'Unknown')}${self?' (you)':''}${d.email===ADMIN_EMAIL?' <span class="admin-tag">Admin</span>':''}</span><span class="email">${esc(d.email||'')}</span><span class="joined">Joined ${j}</span></div>${!self&&d.email!==ADMIN_EMAIL?`<button class="kick-btn ${d.blocked?'unblock':''}" onclick="toggleBlock('${doc.id}',${!d.blocked})">${d.blocked?'Unblock':'Block'}</button>`:''}`;el.appendChild(r);});}catch(e){console.error(e);el.innerHTML='<div class="no-users">Error loading users</div>';}}
async function toggleBlock(uid,block){try{await db.collection('users').doc(uid).update({blocked:block});loadUsers();}catch(e){console.error(e);}}
const tabNames=['gradebook','semester','gpa'];
function switchTab(tab){document.querySelectorAll('.tab-btn').forEach((b,i)=>b.classList.toggle('active',i===tabNames.indexOf(tab)));document.querySelectorAll('.tab-content').forEach(c=>c.classList.remove('active'));document.getElementById('tab-'+tab).classList.add('active');}

// ── Gradebook ──
let assignments=[{name:'',type:'minor',weight:1.0,grade:''}];
function isGraded(a){const g=String(a.grade).trim().toUpperCase();if(g===''||g==='NM')return false;if(g==='NG')return true;return!isNaN(parseFloat(g));}
function gv(a){if(String(a.grade).trim().toUpperCase()==='NG')return 0;return parseFloat(a.grade);}
function esc(s){return s.replace(/&/g,'&amp;').replace(/"/g,'&quot;').replace(/</g,'&lt;').replace(/>/g,'&gt;');}
function render(){const tbody=document.getElementById('assignmentBody');tbody.innerHTML='';assignments.forEach((a,i)=>{const isNM=String(a.grade).trim().toUpperCase()==='NM',isNG=String(a.grade).trim().toUpperCase()==='NG',tr=document.createElement('tr');tr.innerHTML=`<td><input class="name-input" type="text" placeholder="Assignment name" value="${esc(a.name)}" oninput="updateField(${i},'name',this.value)"></td><td><div class="type-toggle"><button class="${a.type==='minor'?'active-minor':''}" onclick="setType(${i},'minor')">Minor</button><button class="${a.type==='major'?'active-major':''}" onclick="setType(${i},'major')">Major</button></div></td><td><input class="num-input" type="number" step="0.1" min="0" value="${a.weight}" oninput="updateField(${i},'weight',parseFloat(this.value)||0)"></td><td><input class="grade-input ${isNM?'nm':''}${isNG?'ng':''}" type="text" placeholder="—" value="${esc(String(a.grade))}" oninput="updateField(${i},'grade',this.value)" onchange="updateField(${i},'grade',this.value)" onblur="updateField(${i},'grade',this.value)"></td><td><button class="delete-btn" onclick="removeRow(${i})">✕</button></td>`;tbody.appendChild(tr);});calculate();}
function updateField(i,f,v){assignments[i][f]=v;calculate();if(f==='grade'){const inp=document.querySelectorAll('.grade-input')[i];if(inp){const u=String(v).trim().toUpperCase();inp.classList.toggle('nm',u==='NM');inp.classList.toggle('ng',u==='NG');}}}
function setType(i,t){assignments[i].type=t;render();}
function addRow(){assignments.push({name:'',type:'minor',weight:1.0,grade:''});render();}
function removeRow(i){if(assignments.length<=1)return;assignments.splice(i,1);render();}
function resetAll(){assignments=[{name:'',type:'minor',weight:1.0,grade:''}];document.getElementById('pasteArea').value='';document.getElementById('pasteStatus').textContent='';document.getElementById('pasteStatus').className='paste-status';render();}
function calculate(){const minorPct=parseFloat(document.getElementById('minorWeight').value)/100||0,majorPct=parseFloat(document.getElementById('majorWeight').value)/100||0,boostMult=1+(parseFloat(document.getElementById('boost').value)/100||0),minors=assignments.filter(a=>a.type==='minor'&&isGraded(a)),majors=assignments.filter(a=>a.type==='major'&&isGraded(a)),drop=document.getElementById('dropLowest').checked;let minorAvg=null;if(minors.length>1&&drop){let li=0;for(let i=1;i<minors.length;i++)if(gv(minors[i])<gv(minors[li]))li=i;const kept=minors.filter((_,i)=>i!==li),tw=kept.reduce((s,a)=>s+a.weight,0);minorAvg=kept.reduce((s,a)=>s+a.weight*gv(a),0)/tw;}else if(minors.length>0){const tw=minors.reduce((s,a)=>s+a.weight,0);minorAvg=minors.reduce((s,a)=>s+a.weight*gv(a),0)/tw;}let majorAvg=null;if(majors.length>0){const tw=majors.reduce((s,a)=>s+a.weight,0);majorAvg=majors.reduce((s,a)=>s+a.weight*gv(a),0)/tw;}let overall=null;if(minorAvg!==null&&majorAvg!==null)overall=minorPct*minorAvg+majorPct*majorAvg;else if(minorAvg!==null)overall=minorAvg;else if(majorAvg!==null)overall=majorAvg;const finalGrade=overall!==null?overall*boostMult:null,r=document.getElementById('results');if(overall===null){r.innerHTML='<div class="result-card final"><div class="result-label">Final Grade</div><div class="result-value">—</div><div class="result-detail">Enter grades to calculate</div></div>';return;}const gc=v=>v>=90?'color-green':v>=75?'color-orange':'color-red';r.innerHTML=`<div class="result-card"><div class="result-label">Minor Avg</div><div class="result-value ${minorAvg!==null?gc(minorAvg):''}">${minorAvg!==null?minorAvg.toFixed(2)+'%':'—'}</div><div class="result-detail">${minors.length} graded</div></div><div class="result-card"><div class="result-label">Major Avg</div><div class="result-value ${majorAvg!==null?gc(majorAvg):''}">${majorAvg!==null?majorAvg.toFixed(2)+'%':'—'}</div><div class="result-detail">${majors.length} graded</div></div><div class="result-card"><div class="result-label">Before Boost</div><div class="result-value ${gc(overall)}">${overall.toFixed(2)}%</div><div class="result-detail">${(minorPct*100).toFixed(0)}% minor · ${(majorPct*100).toFixed(0)}% major</div></div><div class="result-card final"><div class="result-label">Final Grade (×${boostMult.toFixed(2)})</div><div class="result-value">${finalGrade.toFixed(2)}%</div></div>`;}
function parsePastedText(){const raw=document.getElementById('pasteArea').value.trim(),st=document.getElementById('pasteStatus');if(!raw){st.textContent='Paste your gradebook table first';st.className='paste-status error';return;}const lines=raw.split('\n').map(l=>l.trim()).filter(l=>l.length>0),res=[];for(const line of lines){if(/^\s*date\s/i.test(line)&&/assignment/i.test(line))continue;const hasMinor=/minor/i.test(line),hasMajor=/major/i.test(line);if(!hasMinor&&!hasMajor)continue;const type=hasMajor?'major':'minor';let grade='NM';if(/\bNM\b/i.test(line))grade='NM';else if(/\bNG\b/i.test(line))grade='NG';else{const m=[...line.matchAll(/(\d+\.?\d*)\s*\/\s*(\d+)/g)].filter(m=>parseFloat(m[2])===100).pop();if(m)grade=String(parseFloat(m[1]));}let weight=1.0,lw=line.replace(/(\d+\.?\d*)\s*\/\s*(100)\b/g,'').replace(/\bNM\b/gi,'').replace(/\bNG\b/gi,'');const wm=lw.match(/\b(\d+\.\d+)\b/g);if(wm)for(const w of wm){const v=parseFloat(w);if(v>=0.1&&v<=5.0){weight=v;break;}}const tp=line.split(/\t/);if(tp.length>=4)for(let ti=2;ti<tp.length;ti++){const c=tp[ti].trim(),v=parseFloat(c);if(!isNaN(v)&&v>=0.1&&v<=5.0&&c.match(/^\d+\.?\d*$/)){weight=v;break;}}let name=line;name=name.replace(/\b\d{1,2}[\/\-]\d{1,2}[\/\-]\d{2,4}\b/g,'').replace(/(Minor|Major)\s*(Assignment)?\s*\d*/gi,'').replace(/(\d+\.?\d*)\s*\/\s*(100)\b/g,'').replace(/\bNM\b/gi,'').replace(/\bNG\b/gi,'').replace(new RegExp('\\b'+weight.toFixed(1).replace('.','\\.')+'\\b'),'').replace(/\b(Date|Type|Weight|Grade)\b/gi,'').replace(/\t/g,' ').replace(/\s+/g,' ').trim();if(name.length<1)continue;res.push({name,type,weight,grade});}if(!res.length){st.textContent='No assignments found.';st.className='paste-status error';return;}assignments=res;render();const nm=res.filter(a=>a.grade==='NM').length,ng=res.filter(a=>a.grade==='NG').length;let x='';if(nm>0)x+=` (${nm} NM)`;if(ng>0)x+=` (${ng} NG)`;st.textContent=`✓ Imported ${res.length} assignments`+x;st.className='paste-status success';}
document.getElementById('pasteArea').addEventListener('paste',()=>{setTimeout(parsePastedText,100);});

// ── Semester ──
let semBlocks=[{name:'1st Block',q1:'',q2:'',exam:''},{name:'2nd Block',q1:'',q2:'',exam:''},{name:'3rd Block',q1:'',q2:'',exam:''},{name:'4th Block',q1:'',q2:'',exam:''},{name:'5th Block',q1:'',q2:'',exam:''},{name:'6th Block',q1:'',q2:'',exam:''},{name:'7th Block',q1:'',q2:'',exam:''},{name:'8th Block',q1:'',q2:'',exam:''}];
function letterGrade(v){if(v>=90)return{letter:'A',color:'#4ade80',cls:'a'};if(v>=80)return{letter:'B',color:'#6c8cff',cls:'b'};if(v>=70)return{letter:'C',color:'#fb923c',cls:'c'};if(v>=60)return{letter:'D',color:'#f59e0b',cls:'d'};return{letter:'F',color:'#f87171',cls:'f'};}
function gradeToQP(v){if(v>=90)return 4.0;if(v>=80)return 3.0;if(v>=70)return 2.0;if(v>=60)return 1.0;return 0.0;}
function buildSemester(){const el=document.getElementById('semesterBlocks');el.innerHTML='';semBlocks.forEach((b,i)=>{const div=document.createElement('div');div.className='sem-row';div.innerHTML=`<div class="sem-row-header"><input class="name-input" type="text" value="${esc(b.name)}" data-field="name" data-i="${i}" style="background:transparent;border:none;color:var(--text);font-size:14px;font-weight:600;font-family:'DM Sans',sans-serif;padding:0;width:140px;outline:none;"><button class="delete-btn" onclick="removeSemBlock(${i})">✕</button></div><div class="sem-inputs"><div class="sem-field"><label>1st 9 Weeks</label><input type="number" value="${b.q1}" placeholder="—" data-field="q1" data-i="${i}"></div><div class="sem-field"><label>2nd 9 Weeks</label><input type="number" value="${b.q2}" placeholder="—" data-field="q2" data-i="${i}"></div><div class="sem-field"><label>Term Avg</label><input type="text" class="sem-computed" id="sem-term-${i}" value="—" readonly></div><div class="sem-field"><label>Exam Grade</label><input type="number" value="${b.exam}" placeholder="—" data-field="exam" data-i="${i}"></div><div class="sem-field"><label>Final Avg</label><input type="text" class="sem-computed" id="sem-final-${i}" value="—" readonly><div class="sem-letter" id="sem-letter-${i}"></div></div></div>`;el.appendChild(div);});el.querySelectorAll('input[data-field]').forEach(inp=>{inp.addEventListener('input',function(){semBlocks[parseInt(this.dataset.i)][this.dataset.field]=this.value;updateSemComputed(parseInt(this.dataset.i));});});semBlocks.forEach((_,i)=>updateSemComputed(i));}
function updateSemComputed(i){const b=semBlocks[i],q1=parseFloat(b.q1),q2=parseFloat(b.q2),ex=parseFloat(b.exam),hasQ=!isNaN(q1)&&!isNaN(q2),termAvg=hasQ?(q1+q2)/2:null,final=hasQ&&!isNaN(ex)?(termAvg*0.8+ex*0.2):null,termEl=document.getElementById('sem-term-'+i),finalEl=document.getElementById('sem-final-'+i),letterEl=document.getElementById('sem-letter-'+i);if(termEl){termEl.value=termAvg!==null?termAvg.toFixed(2):'—';termEl.style.color=termAvg!==null?letterGrade(termAvg).color:'var(--text-muted)';}if(finalEl){finalEl.value=final!==null?final.toFixed(2):'—';if(final!==null){const lg=letterGrade(final);finalEl.style.color=lg.color;letterEl.textContent=lg.letter;letterEl.style.color=lg.color;}else{finalEl.style.color='var(--text-muted)';letterEl.textContent='';}}}
function addSemBlock(){semBlocks.push({name:'Block '+(semBlocks.length+1),q1:'',q2:'',exam:''});buildSemester();}
function removeSemBlock(i){if(semBlocks.length<=1)return;semBlocks.splice(i,1);buildSemester();}

// ── GPA / QPA ──
let historyCourses=[], currentCourses=[];
function parseHistoryCourses(){
  const raw=document.getElementById('gpaHistoryArea').value.trim(),st=document.getElementById('gpaHistoryStatus');
  if(!raw){st.textContent='Paste history courses first';st.className='paste-status error';return;}
  const lines=raw.split('\n').map(l=>l.trim()).filter(l=>l);historyCourses=[];
  for(const line of lines){
    if(/^Course\s*Name/i.test(line))continue;if(/^History\s*Courses/i.test(line))continue;
    const parts=line.split('\t').map(p=>p.trim());
    const nums=parts.filter(p=>/^\d+\.?\d*$/.test(p)).map(p=>parseFloat(p));
    if(nums.length<3)continue;
    let gradeCols=[];for(let j=0;j<parts.length;j++){if(/^\d+\.?\d{2,}$/.test(parts[j]))gradeCols.push(j);}
    if(gradeCols.length<4)continue;
    const courseName=parts[0];if(!courseName||courseName.length<2)continue;
    if(/^(Madison|Rosa|High School|Middle School)/i.test(courseName)&&gradeCols.length<4)continue;
    if(/Grade:/i.test(line))continue;
    const finalGrade=parseFloat(parts[gradeCols[0]]),qps=parseFloat(parts[gradeCols[1]]),crEarned=parseFloat(parts[gradeCols[gradeCols.length-1]]);
    if(isNaN(finalGrade)||isNaN(qps)||isNaN(crEarned))continue;if(finalGrade<10||finalGrade>150)continue;if(crEarned<=0||crEarned>5)continue;
    historyCourses.push({name:courseName,grade:finalGrade,qps:qps,credits:crEarned,source:'history'});
  }
  if(!historyCourses.length){st.textContent='No courses found. Check format.';st.className='paste-status error';return;}
  st.textContent=`✓ Imported ${historyCourses.length} history courses`;st.className='paste-status success';renderGPA();
}
function parseCurrentCourses(){
  const raw=document.getElementById('gpaCurrentArea').value.trim(),st=document.getElementById('gpaCurrentStatus');
  if(!raw){st.textContent='Paste current grades first';st.className='paste-status error';return;}
  const lines=raw.split('\n').map(l=>l.trim()).filter(l=>l);currentCourses=[];
  for(const line of lines){
    if(/^Course\s/i.test(line)&&/Period/i.test(line))continue;if(/Exam\s*Grades/i.test(line))continue;if(/Dismissal/i.test(line))continue;
    const parts=line.split('\t').map(p=>p.trim());if(parts.length<3)continue;
    const courseName=parts[0];if(!courseName||courseName.length<2)continue;
    const termGrades=[];for(let j=2;j<parts.length;j++){const n=parseFloat(parts[j].trim());if(!isNaN(n)&&n>0&&n<=150)termGrades.push(n);}
    if(termGrades.length===0)continue;
    const avg=termGrades.reduce((s,v)=>s+v,0)/termGrades.length;
    currentCourses.push({name:courseName,grade:avg,termGrades:termGrades,credits:1.0,source:'current'});
  }
  if(!currentCourses.length){st.textContent='No courses found. Check format.';st.className='paste-status error';return;}
  st.textContent=`✓ Imported ${currentCourses.length} current courses`;st.className='paste-status success';renderGPA();
}
function renderGPA(){
  const wrapper=document.getElementById('gpaTableWrapper'),tbody=document.getElementById('gpaBody'),resDiv=document.getElementById('gpaResults');
  const allCourses=[...currentCourses,...historyCourses];
  if(!allCourses.length){wrapper.style.display='none';resDiv.innerHTML='';return;}
  wrapper.style.display='';
  let gpaTotalW=0,gpaTotalC=0;
  historyCourses.forEach(c=>{gpaTotalW+=c.grade*c.credits;gpaTotalC+=c.credits;});
  currentCourses.forEach(c=>{gpaTotalW+=c.grade*c.credits;gpaTotalC+=c.credits;});
  const gpa=gpaTotalC>0?(gpaTotalW/gpaTotalC):0;
  let qpaTotalW=0,qpaTotalC=0;
  historyCourses.forEach(c=>{qpaTotalW+=c.qps*c.credits;qpaTotalC+=c.credits;});
  currentCourses.forEach(c=>{const n=c.termGrades.length;const perTermCredit=c.credits/n;c.termGrades.forEach(g=>{qpaTotalW+=gradeToQP(g)*perTermCredit;qpaTotalC+=perTermCredit;});});
  const qpa=qpaTotalC>0?(qpaTotalW/qpaTotalC):0;
  const gc=v=>v>=90?'color-green':v>=75?'color-orange':'color-red';
  const qc=v=>v>=3.5?'color-green':v>=2.5?'color-orange':'color-red';
  resDiv.innerHTML=`<div class="result-card"><div class="result-label">GPA (out of 100)</div><div class="result-value ${gc(gpa)}">${gpa.toFixed(2)}</div><div class="result-detail">${allCourses.length} courses · ${gpaTotalC.toFixed(1)} credits</div></div><div class="result-card"><div class="result-label">QPA (4.0 scale)</div><div class="result-value ${qc(qpa)}">${qpa.toFixed(3)}</div><div class="result-detail">Each 9-weeks counted separately</div></div>`;
  tbody.innerHTML='';
  if(currentCourses.length>0){
    const hdr=document.createElement('tr');hdr.className='section-header';hdr.innerHTML=`<td colspan="5">Current Year (${currentCourses.length})</td>`;tbody.appendChild(hdr);
    currentCourses.forEach(c=>{const lg=letterGrade(c.grade),terms=c.termGrades.map(t=>t.toFixed(0)).join(', '),tr=document.createElement('tr');tr.innerHTML=`<td class="course-name" title="${esc(c.name)}">${esc(c.name)}</td><td class="num" title="Terms: ${terms}">${c.grade.toFixed(1)}</td><td class="num">${gradeToQP(c.grade).toFixed(1)}</td><td class="num">${c.credits.toFixed(1)}</td><td class="num"><span class="gpa-tag gpa-tag-${lg.cls}">${lg.letter}</span></td>`;tbody.appendChild(tr);});
  }
  if(historyCourses.length>0){
    const hdr=document.createElement('tr');hdr.className='section-header';hdr.innerHTML=`<td colspan="5">History Courses (${historyCourses.length})</td>`;tbody.appendChild(hdr);
    historyCourses.forEach(c=>{const lg=letterGrade(c.grade),tr=document.createElement('tr');tr.innerHTML=`<td class="course-name" title="${esc(c.name)}">${esc(c.name)}</td><td class="num">${c.grade.toFixed(1)}</td><td class="num">${c.qps.toFixed(1)}</td><td class="num">${c.credits.toFixed(1)}</td><td class="num"><span class="gpa-tag gpa-tag-${lg.cls}">${lg.letter}</span></td>`;tbody.appendChild(tr);});
  }
}
function resetGPA(){historyCourses=[];currentCourses=[];document.getElementById('gpaHistoryArea').value='';document.getElementById('gpaCurrentArea').value='';document.getElementById('gpaHistoryStatus').textContent='';document.getElementById('gpaCurrentStatus').textContent='';document.getElementById('gpaHistoryStatus').className='paste-status';document.getElementById('gpaCurrentStatus').className='paste-status';document.getElementById('gpaTableWrapper').style.display='none';document.getElementById('gpaResults').innerHTML='';}
document.getElementById('gpaHistoryArea').addEventListener('paste',()=>{setTimeout(parseHistoryCourses,100);});
document.getElementById('gpaCurrentArea').addEventListener('paste',()=>{setTimeout(parseCurrentCourses,100);});
render();buildSemester();
</script>
</body>
</html>
